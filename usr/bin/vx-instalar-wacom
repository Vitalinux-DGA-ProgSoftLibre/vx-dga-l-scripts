#!/bin/bash
USER=$(whoami)

function instalar-software {
	(
	echo "A continuación va a comenzar la instalación de todo lo necesario para la Wacom ..."
	echo "Ten paciencia por favor ... "
	echo "No cierres la ventana hasta que se te indique a no ser que aparezcan errores ..."
	sleep 7
	apt-get --assume-yes --force-yes update
	apt-get --assume-yes --force-yes install libx11-dev libxi-dev x11proto-input-dev xserver-xorg-dev tk8.4-dev tcl8.4-dev libncurses5-dev
	apt-get --assume-yes --force-yes install xserver-xorg-core
	apt-get --assume-yes --force-yes install xserver-xorg-input-wacom
	apt-get --assume-yes --force-yes install lubuntu-desktop 
	echo -e "\n\nGracias por la espera... \nAhora ya puedes cerrar la ventana ..."
	) | yad --title "Migasfree" --text-info --tail \
		--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
		--width="500" --height="400" --center --button=Cerrar:0

	yad --title "Instalar y Configurar la Pantalla Táctil Wacom" \
		 --text "   Si no has detectado errores ya debería estar todo configurado ...\n   <b>Reinicia el equipo para comprobar que funciona la Pantalla Táctil Wacom</b>   " \
		--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
		--image "/usr/share/lxpanel/images/wacom-48.png" \
		--width="400" --height="100" --center --justify="center" --text-align="center" --button=Terminar:0
}

if test $USER = "root" 
	then
		if /usr/bin/xinput --list | grep Wacom &> /dev/null ; then
			yad --title "Instalar y Configurar la Pantalla Táctil Wacom" --info --text "   Programa para Instalar y Configurar la Pantalla Táctil Wacom   " \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
			--image "/usr/share/lxpanel/images/wacom-48.png" \
			--width="400" --height="100" --center --justify="center" --text-align="center"
			if aptitude search input-wacom | grep "^i" &> /dev/null ; then
				if yad --title "Instalar y Configurar la Pantalla Táctil Wacom" \
				 --text "   Parece que ya tienes instalado el software para la Pantalla Táctil Wacom ...\n   <b>¿Quieres continuar con la instalación</b>   " \
				--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
				--image "/usr/share/lxpanel/images/wacom-48.png" \
				--width="400" --height="100" --center --justify="center" --text-align="center" \
				--button=Continuar:0 --button=Terminar:1 ; then
					instalar-software
				fi
			else
				instalar-software
			fi
		else
			if yad --title "Instalar y Configurar la Pantalla Táctil Wacom" \
			 --text "   Perdona pero hay un problema ...\n   <b>No se detecta ninguna Wacom en el equipo</b>   \n\n   <b>No obstante ... ¿Quieres Probar a Instalar el software necesario?</b>" \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
			--image "/usr/share/lxpanel/images/wacom-48.png" \
			--width="400" --height="100" --center --justify="center" --text-align="center" \
			--button=Continuar:0 --button="No Seguir":1 ; then
				instalar-software
			fi
		fi
	else
		yad --title "Instalar y Configurar la Pantalla Táctil Wacom" \
		--text "No tiene permiso para ejecutar el programa"\
		--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
		--width="400" --height="100" --center --justify="center" --text-align="center" --button=Terminar:1
  fi
