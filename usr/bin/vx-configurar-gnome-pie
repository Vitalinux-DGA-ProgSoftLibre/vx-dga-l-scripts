#!/bin/bash
USER=$(whoami)

if test $USER = "root"
then

	if yad --title "Configurar Comportamiento Gnome Pie" \
		--text "  Indica que quieres Hacer con el Gnome Pie ...  " \
		--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
		--image gnome-pie \
		--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=10 \
		--button="Deshabilitar Gnome Pie":0  --button="Habilitar Gnome Pie":1 ; then

		if test -f /etc/xdg/autostart/gnome-pie.desktop ; then
			desktop-file-edit --add-not-show-in=LXDE /etc/xdg/autostart/gnome-pie.desktop
		else
			yad --title "Configurar Comportamiento Gnome Pie" \
				--text " Hay un error con la instalación base de Gnome-Pie" \
				--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
				--image plank \
				--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
				--button="Cerrar Ventana":0
			exit 1
		fi
		
		# Borramos posibles lanzadores creados personalizados por usuarios
		for HOMEUSU in $(vx-home-usuarios-graficos)
		do
			if test -f  $HOMEUSU/.config/autostart/gnome-pie.desktop ; then
				rm -f $HOMEUSU/.config/autostart/gnome-pie.desktop
			fi
		done

			yad --title "Configurar Comportamiento Gnome Pie" \
				--text "  Se ha deshabilitado el Gnome Pie  \n  Lo podrás comprobar la próxima vez que inicies sesión  " \
				--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
				--image gnome-pie \
				--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
				--button="Cerrar Ventana":0

	elif [[ $? -eq 1 ]]; then

		# Instalamos por si acaso el lanzador:
		if ! test -f /usr/share/applications/gnome-pie.desktop ; then
			yad --title "Configurar Comportamiento Dock Plank" \
				--text " Hay un error con la instalación base de Gnome-Pie" \
				--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
				--image plank \
				--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
				--button="Cerrar Ventana":0
			exit 1
		fi
		desktop-file-install --dir=/etc/xdg/autostart/ /usr/share/applications/gnome-pie.desktop
		desktop-file-edit --remove-not-show-in=LXDE /etc/xdg/autostart/gnome-pie.desktop

		yad --title "Configurar Comportamiento Gnome Pie" \
			--text "  Se ha habilitado el Gnome Pie  \n  Lo podrás comprobar la próxima vez que inicies sesión  " \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
			--image gnome-pie \
			--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
			--button="Cerrar Ventana":0
	else
		yad --title "Configurar Comportamiento Dock Plank" \
				--text "  No se modifica el comportamiento ya establecido" \
				--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
				--image plank \
				--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
				--button="Cerrar Ventana":0
	fi
else
		yad --title "Configurar Comportamiento Gnome Pie" \
			--image gnome-pie \
			--info --text "No tiene permiso para ejecutar el programa" \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
			--width="400" --height="100" --center --justify="center" --timeout=7 --text-align="center"
fi
