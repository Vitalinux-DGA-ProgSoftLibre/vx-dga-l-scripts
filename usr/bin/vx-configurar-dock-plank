#!/bin/bash
USER=$(whoami)

if test $USER = "root"
then

	if yad --title "Configurar Comportamiento Dock Plank" \
		--text "  Indica que quieres Hacer con el Dock Plank ...  " \
		--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
		--image plank \
		--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
		--button="Deshabilitar Dock Plank":0  --button="Habilitar Dock Plank":1 ; then

		# En la nueva versión de vx-dga-l-dock-plank el lanzador esta en /etc/xdg/autostart
		if test -f /etc/xdg/autostart/lanzar-dock-plank.desktop ; then
			if chmod 000 /etc/xdg/autostart/lanzar-dock-plank.desktop ; then
							yad --title "Configurar Comportamiento Dock Plank" \
				--text "  Se ha deshabilitado el dock plank  \n  Lo podrás comprobar la próxima vez que inicies sesión  " \
				--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
				--image plank \
				--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
				--button="Cerrar Ventana":0
			fi
		fi
		# En versiones viejas con vx-dga-l-dock-plank-and-conky se inicia en ~/.config/lxsession/Lubuntu/autostart
		for HOMEUSU in $( getent passwd | awk -F ":" '{if ( $3 > 999 &&  $7~/\/bin\/.*/) {print $6}}' )
		do
			if test -f $HOMEUSU/.config/lxsession/Lubuntu/autostart ; then
				sed --follow-symlinks -i "/.*plank.*/d" $HOMEUSU/.config/lxsession/Lubuntu/autostart
			fi
		done
	else

		# En la nueva versión de vx-dga-l-dock-plank el lanzador esta en /etc/xdg/autostart
		if test -f /etc/xdg/autostart/lanzar-dock-plank.desktop ; then
			if chmod 644 /etc/xdg/autostart/lanzar-dock-plank.desktop ; then
				yad --title "Configurar Comportamiento Dock Plank" \
				--text "  Se ha habilitado el dock plank  \n  Lo podrás comprobar la próxima vez que inicies sesión  " \
				--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
				--image plank \
				--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
				--button="Cerrar Ventana":0
			fi
		fi
		
	fi
else
		yad --title "Configurar Comportamiento Dock Plank" \
			--image plank \
			--info --text "No tiene permiso para ejecutar el programa" \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
			--width="400" --height="100" --center --justify="center" --timeout=7 --text-align="center"
fi
