#!/bin/bash
# Versiones: [arturo@2019-12-18]

uso() {
    echo "
# ¡¡Debes ser usuario root para ejecutar este script de gestión de lanzadores desktop!!
# El script debe recibir al estos 8 parámetros:
# 1) El nombre del fichero: p.e. vx-mi-lanzador.desktop
# 2) El Name del descriptor Desktop: p.e. Google Docs
# 3) El Name[es] del descriptor Desktop: p.e. Google Docs
# 4) El Comment del descriptor Desktop: p.e. Google Documents
# 5) El Comment[es] del descriptor Desktop: p.e. Documentos de Google
# 6) El Exec del descriptor Desktop: \"p.e. google-chrome-stable https://docs.google.com\"
# 7) El Icon del descriptor Desktop: p.e. logo-google-docs
# 8) Las Categories del descriptor Desktop: p.e. Education;
    "
}

function crear-lanzador-desktop {
    # Si Existe el lanzador ya creado retornamos al principal:
    [ -f "${1}" ] && return 1
    # crear-lanzador-desktop NOMBRE_ARCHIVO LUGAR
	cat > "${1}"<<EOF
[Desktop Entry]
Encoding=UTF-8
Name=${NAME}
Name[es]=${NAME_ES}
Exec=${EXEC}
Icon=${LOGO_DESK}
Categories=${CATEGORIAS}
Comment=${COMENTARIO}
Comment[es]=${COMENTARIO_ES}
Type=Application
Terminal=false
EOF
    return 0
}

[[ "$(whoami)" != "root" ]] && \
uso && exit 1

(( ${#} != 8 )) && \
uso && exit 1

USUARIO=$(vx-usuario-grafico)
HOMEUSUARIO=$(vx-home-usuario-grafico)
if [ -z "$USUARIO" ] || [ ! -d "${HOMEUSUARIO}" ]  ; then
    echo "=> Problemas con el usuario gráfico ..."
    exit 1
fi

[ ! -z "${1}" ] && \
{
    [[ "${1##*.}" == "desktop" ]] && \
    LANZADOR="${1}" || \
    uso && exit 1
}
NAME="${2}"
NAME_ES="${3}"
COMENTARIO="${4}"
COMENTARIO_ES="${5}"
EXEC="${6}"
# Logo SVG guardado normalmente en: /usr/share/icons/hicolor/scalable/apps/
LOGO_DESK="${7}"
CATEGORIAS="${8}"

# Creamos los lanzadores:
[ -d "${HOMEUSUARIO}/Escritorio" ] && \
( crear-lanzador-desktop "${HOMEUSUARIO}/Escritorio/${LANZADOR}" && \
chown "${USUARIO}" "${HOMEUSUARIO}/Escritorio/${LANZADOR}" )
[ -d "${HOMEUSUARIO}/Desktop" ] && \
( crear-lanzador-desktop "${HOMEUSUARIO}/Desktop/${LANZADOR}" && \
chown "${USUARIO}" "${HOMEUSUARIO}/Desktop/${LANZADOR}" )
[ -d "/etc/skel/Escritorio" ] && \
crear-lanzador-desktop "/etc/skel/Escritorio/${LANZADOR}"
[ -d "/usr/share/applications" ] && \
crear-lanzador-desktop "/usr/share/applications/${LANZADOR}"
