#!/bin/bash
USER=$(whoami)
ESTADO1=1
ESTADO2=1
if test $USER = "root"
then
		yad --title "Información" --info --text "Se Va a Comprobar y Reparar el Software del Equipo" \
		--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
		--image "/usr/share/icons/vitalinux/application-check.png" \
		--width="350" --height="100" --justify="center" --center --text-align="center" --timeout=5 \
		--button=Continuar:0

		(
		echo "--> Va a empezar a comprobarse y reparar el software ..."
		echo "--> ¡¡No cierres la ventana!! Espera a que un mensaje te lo indique ..."
		echo "..."
		if dpkg --configure -a ; then
			echo "--> Ok - Todo el software del equipo esta correctamente configurado ..."
			ESTADO1=0
		fi
		if apt-get install -f ; then
			echo "--> Ok - Todos las dependencias estan correctamente instaladas ..."
			ESTADO2=0
		fi
		echo "..."
		echo "--> Ya puedes cerrar la ventana ..."
		) | yad --title "Comprobando ..." --text-info \
			--image "/usr/share/icons/vitalinux/application-check.png" \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg --tail \
			--center --width="600" --height="500" --button="Cerrar Ventana":0

		if test $ESTADO1 -eq 0 -a $ESTADO2 -eq 0 ;  then
			yad --title "Completado" --info \
			--image "/usr/share/icons/vitalinux/application-check.png" \
			--text "La Comprobación y Reparación del Software se ha Completado" --center \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
			--width="350" --height="100" --timeout=7 --text-align="center"
		else
			yad --title "Problemas ..." --info \
			--image "/usr/share/icons/vitalinux/application-check.png" \
			--text " Es posible que haya habido problemas con \n la Comprobación y Reparación del Sotware" \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
			--center --width="350" --height="100" --timeout=7 --text-align="center"
		fi
else
		yad --title "Comprobar y Reparar el Software" \
			--image "/usr/share/icons/vitalinux/application-check.png" \
			--info --text "No tiene permiso para ejecutar el programa" \
			--window-icon=/usr/share/lxpanel/images/vitalinux.svg \
			--width="400" --height="100" --center --justify="center" --timeout=7 --text-align="center"
fi
